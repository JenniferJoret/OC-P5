const cartContentDetail=document.getElementById("cart-body");let mailValue=document.getElementById("email"),confirmShipping=document.getElementById("confirm"),alertWarning=document.getElementById("alert-warning"),form=document.querySelector("form"),cartBuyBtn=document.getElementById("cart-buy"),total=0,i=0,shippingContent={contact:{},products:[]};function validateEmail(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}const sendCart=async()=>{const t=await fetch("http://localhost:3000/api/teddies/order",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(shippingContent)});return await t.json()};if(localStorage.cartItems){const t=JSON.parse(localStorage.cartItems);t.forEach(e=>{total+=parseInt(e.price);let a=document.createElement("tr");a.classList.add("cart-inner"),a.innerHTML='<td class="pic-title col-12 col-sm-auto"><div class="d-flex w-100 align-items-center"><img src="'+e.url+'" class="img-sm mr-3"> <span class="info"> <a href="product.html?id='+e.id+'" class="title text-dark" data-abc="true">'+e.name+'</a> <p class="text-muted small">'+e.color+' </span> </div></td><td class="qte"> <p class="pl-4 text-bold h5 ">'+e.quantity+'</p></td><td class="prices"><div class="price-wrap"><p class="price mb-0">'+e.price+' €</p> <small class="text-muted"> '+e.price/e.quantity+' € l\'unité </small> </div></td><td class="text-right delete d-flex"> </a> <button id="delete-'+i+'" value="'+i+'" class="btn btn-warning"><span class="fa fa-trash" aria-hidden="true"></span> </button></td>',cartContentDetail.appendChild(a),shippingContent.products.push(e.id);let n=document.getElementById("delete-"+i);n.onclick=function(){t.splice(n.value,1),localStorage.setItem("cartItems",JSON.stringify(t)),document.location.reload(!0),0===t.length&&localStorage.removeItem("cartItems")},i++});let e=document.createElement("tr");e.classList.add("cart-total"),e.innerHTML='<tr><td></td><td class="text-right"><strong>Total</strong></><td class="text-left"><strong>'+total+" €</strong></td></tr>",cartContentDetail.appendChild(e),document.getElementById("total1").innerText=total+" €",document.getElementById("finalTotal").innerText=total+" €"}else{document.getElementById("cart-bloc").style.display="none";let t=document.createElement("h4");t.classList.add("text-center","h1","mx-auto","bg-white","p-5","rounded"),t.innerText="Votre panier est vide !",document.getElementById("main").appendChild(t)}cartBuyBtn.addEventListener("click",(function(){document.getElementById("cart-bloc").style.display="none";let t=document.getElementById("shipping-form");t.classList.remove("d-none"),t.style.display="bloc"})),form.addEventListener("input",(function(){!1===validateEmail(mailValue.value)?(alertWarning.classList.remove("d-none"),alertWarning.innerHTML="<p>Veuillez renseigner une adresse valide</p>"):alertWarning.classList.add("d-none")})),form.addEventListener("submit",async t=>{t.preventDefault();let e=$("form").serializeArray();shippingContent.contact={firstName:e[0].value,lastName:e[1].value,address:e[2].value,city:e[3].value,email:e[4].value};const a=await sendCart();window.location=`./confirmation.html?id=${a.orderId}&user=${firstName.value}&total=${total}`});